/*++
  This file contains an 'Intel Peripheral Driver' and is
  licensed for Intel CPUs and chipsets under the terms of your
  license agreement with Intel or your vendor.  This file may
  be modified by the user, subject to additional terms of the
  license agreement
--*/
/*++

Copyright (c)  1999 - 2013 Intel Corporation. All rights reserved
This software and associated documentation (if any) is furnished
under a license and may only be used or copied in accordance
with the terms of the license. Except as permitted by such
license, no part of this software or documentation may be
reproduced, stored in a retrieval system, or transmitted in any
form or by any means without the express written consent of
Intel Corporation.

--*/

/*++
Module Name:

  PnpDxe.c

Abstract:
  This driver initialize the power and performance Setting.

--*/

#include "PnPDxe.h"







PNP_SETTING g_PnPValueForPwrPerfA0Stepping[] = {
  0x00,  0x18,  22,  22,  0x1,  
  0x00,  0x18,  21,  21,  0x1,  
  0x00,  0x18,  20,  20,  0x1,  
  0x00,  0x18,  19,  19,  0x1,  
  0x00,  0x18,  18,  18,  0x1,  
  0x00,  0x18,  17,  17,  0x1,  
  0x00,  0x18,  16,  16,  0x1,  
  0x00,  0x18,  15,  15,  0x1,  
  0x00,  0x18,  14,  14,  0x1,  
  0x00,  0x18,  12,  12,  0x1,  
  0x00,  0x18,  11,  11,  0x1,  
  0x00,  0x18,  10,  10,  0x1,  
  0x00,  0x18,  9,  9,  0x1,  
  0x00,  0x18,  8,  8,  0x1,  
  0x00,  0x18,  7,  7,  0x1,  
  0x00,  0x18,  6,  6,  0x1,  
  0x00,  0x18,  5,  5,  0x1,  
  0x00,  0x18,  4,  4,  0x1,  
  0x00,  0x18,  3,  3,  0x1,  
  0x00,  0x18,  2,  2,  0x1,  
  0x00,  0x18,  1,  1,  0x1,  
  0x00,  0x18,  0,  0,  0x1,  
  0x00,  0x20,  26,  24,  0x2,  
  0x00,  0x20,  8,  0,  0x1,  
  0x00,  0x21,  31,  31,  0x1,  
  0x00,  0x21,  8,  8,  0x1,  
  0x00,  0x0C0,  11,  8,  0x4,  
  0x00,  0x0C0,  7,  4,  0x4,  
  0x00,  0x0C0,  3,  0,  0x4,  
  0x03,  0x3,  29,  24,  0x4,  
  0x03,  0x3,  21,  16,  0x4,  
  0x03,  0x3,  13,  8,  0x4,  
  0x03,  0x3,  5,  0,  0x4,  
  0x03,  0x4,  29,  24,  0x4,  
  0x03,  0x4,  21,  16,  0x4,  
  0x03,  0x4,  13,  8,  0x4,  
  0x03,  0x4,  5,  0,  0x4,  
  0x03,  0x5,  21,  16,  0x4,  
  0x03,  0x5,  13,  8,  0x4,  
  0x03,  0x5,  5,  0,  0x8,  
  0x03,  0x7,  31,  24,  0x20,  
  0x03,  0x7,  15,  8,  0x0A,  
  0x03,  0x7,  7,  0,  0x10,  
  0x03,  0x8,  23,  0,  0x0,  
  0x03,  0x9,  23,  0,  0x3FFFFC,  
  0x03,  0x0A,  9,  0,  0x080,  
  0x03,  0x0B,  29,  24,  0x1F,  
  0x03,  0x0B,  21,  16,  0x2F,  
  0x03,  0x0B,  13,  8,  0x2F,  
  0x03,  0x0B,  5,  0,  0x2F,  
  0x03,  0x0C,  29,  24,  0x2F,  
  0x03,  0x0C,  21,  16,  0x2F,  
  0x03,  0x0C,  13,  8,  0x2F,  
  0x03,  0x0C,  5,  0,  0x2B,  
  0x03,  0x0D,  21,  16,  0x2F,  
  0x03,  0x0D,  13,  8,  0x2F,  
  0x03,  0x0D,  5,  0,  0x2F,  
  0x03,  0x0F,  29,  28,  0x0,  
  0x03,  0x0F,  25,  24,  0x0,  
  0x03,  0x0F,  21,  20,  0x0,  
  0x03,  0x0F,  17,  16,  0x0,  
  0x03,  0x0F,  13,  12,  0x0,  
  0x03,  0x0F,  9,  8,  0x0,  
  0x03,  0x0F,  5,  4,  0x0,  
  0x03,  0x0F,  1,  0,  0x0,  
  0x03,  0x10,  9,  8,  0x0,  
  0x03,  0x10,  5,  4,  0x0,  
  0x03,  0x10,  1,  0,  0x0,  
  0x03,  0x11,  31,  22,  0x20,  
  0x03,  0x11,  17,  12,  0x4,  
  0x03,  0x11,  11,  8,  0x8,  
  0x03,  0x11,  6,  0,  0xC,  
  0x03,  0x12,  31,  30,  0x0,  
  0x03,  0x12,  29,  28,  0x0,  
  0x03,  0x12,  27,  26,  0x0,  
  0x03,  0x12,  25,  24,  0x0,  
  0x03,  0x12,  23,  22,  0x0,  
  0x03,  0x12,  21,  20,  0x0,  
  0x03,  0x12,  19,  18,  0x0,  
  0x03,  0x12,  17,  16,  0x1,  
  0x03,  0x12,  15,  14,  0x0,  
  0x03,  0x12,  13,  12,  0x0,  
  0x03,  0x12,  11,  10,  0x1,  
  0x03,  0x12,  9,  8,  0x1,  
  0x03,  0x12,  7,  6,  0x0,  
  0x03,  0x12,  5,  4,  0x0,  
  0x03,  0x12,  3,  2,  0x0,  
  0x03,  0x12,  1,  0,  0x0,  
  0x03,  0x14,  31,  31,  0x0,  
  0x03,  0x14,  30,  30,  0x0,  
  0x03,  0x14,  13,  8,  0x8,  
  0x03,  0x14,  5,  0,  0x10,  
  0x03,  0x16,  31,  31,  0x0,  
  0x03,  0x16,  13,  8,  0x3F,  
  0x03,  0x16,  5,  0,  0x8,  
  0x03,  0x18,  31,  24,  0x20,  
  0x03,  0x18,  23,  21,  0x6,  
  0x03,  0x18,  13,  7,  0x0,  
  0x03,  0x18,  6,  0,  0x20,  
  0x03,  0x3B,  23,  16,  0x4,  
  0x03,  0x3B,  9,  9,  0x0,  
  0x03,  0x3B,  7,  0,  0x0A,  
  0x03,  0x3C,  31,  16,  0x0FFFF,  
  0x03,  0x3C,  2,  2,  0x0,  
  0x03,  0x3C,  1,  1,  0x0,  
  0x03,  0x3D,  14,  14,  0x1,  
  0x03,  0x3D,  13,  13,  0x0,  
  0x03,  0x3D,  12,  12,  0x0,  
  0x03,  0x3D,  11,  11,  0x0,  
  0x03,  0x3D,  8,  8,  0x0,  
  0x03,  0x3D,  7,  7,  0x0,  
  0x03,  0x3D,  6,  6,  0x0,  
  0x03,  0x3D,  5,  5,  0x0,  
  0x03,  0x3D,  2,  2,  0x1,  
  0x03,  0x3D,  1,  1,  0x1,  
  0x03,  0x3D,  0,  0,  0x1,  
  0x03,  0x3E,  31,  16,  0x0,  
  0x03,  0x3E,  7,  0,  0x20,  
  0x03,  0x3F,  31,  24,  0x0FF,  
  0x03,  0x3F,  23,  16,  0x0FF,  
  0x03,  0x3F,  15,  8,  0x0FF,  
  0x03,  0x3F,  7,  0,  0x0FF,  
  0x02,  0x3,  20,  20,  0x1,  
  0x02,  0x3,  19,  19,  0x0,  
  0x02,  0x3,  18,  18,  0x0,  
  0x02,  0x3,  17,  17,  0x0,  
  0x02,  0x3,  16,  16,  0x1,  
  0x02,  0x3,  15,  15,  0x0,  
  
  0x02,  0x3,  10,  10,  0x1,  
  0x02,  0x3,  3,  3,  0x0,  
  0x02,  0x3,  2,  2,  0x0,  
  0x02,  0x4,  18,  18,  0x1,  
  0x02,  0x4,  4,  1,  0x8,  
  0x02,  0x4,  0,  0,  0x0,  
  0x02,  0x5,  27,  27,  0x1,  
  0x02,  0x5,  26,  26,  0x1,  
  0x02,  0x5,  25,  25,  0x1,  
  0x02,  0x5,  24,  24,  0x1,  
  0x02,  0x5,  23,  23,  0x1,  
  0x02,  0x5,  22,  22,  0x1,  
  0x02,  0x5,  21,  21,  0x1,  
  0x02,  0x5,  20,  20,  0x1,  
  0x02,  0x5,  19,  19,  0x1,  
  0x02,  0x5,  18,  18,  0x1,  
  0x02,  0x5,  17,  17,  0x1,  
  0x02,  0x5,  16,  16,  0x1,  
  0x02,  0x5,  15,  15,  0x1,  
  0x02,  0x5,  14,  14,  0x1,  
  0x02,  0x5,  13,  13,  0x1,  
  0x02,  0x5,  12,  12,  0x1,  
  0x02,  0x5,  11,  11,  0x1,  
  0x02,  0x5,  10,  10,  0x1,  
  0x02,  0x5,  9,  9,  0x1,  
  0x02,  0x5,  8,  8,  0x1,  
  0x02,  0x5,  7,  7,  0x1,  
  0x02,  0x5,  6,  6,  0x1,  
  0x02,  0x5,  5,  5,  0x1,  
  0x02,  0x5,  4,  4,  0x1,  
  0x02,  0x5,  3,  3,  0x1,  
  0x02,  0x5,  2,  2,  0x1,  
  0x02,  0x5,  1,  1,  0x1,  
  0x02,  0x5,  0,  0,  0x1,  
  0x58,  0x40,  4,  4,  0x0,  
  0x58,  0x40,  4,  4,  0x0,  
  0x58,  0x40,  4,  4,  0x0,  
  0x55,  0x54,  1,  0,  0x0,  
  0x55,  0x0FC,  17,  17,  0x0,  
  0x55,  0x0FC,  9,  9,  0x0,  
  0xA2,  0x0C000,  0,  0,  0x0,  
  0x47,  0x0C000,  0,  0,  0x0,  
  0x45,  0x0C000,  0,  0,  0x0,  
  0x46,  0x0C000,  0,  0,  0x0,  
};





PNP_SETTING g_PnPValueForPwrPerfB0Stepping[] = {
  
  
  
  0x00,  0x18,  22,  22,  0x1,  
  0x00,  0x18,  21,  21,  0x1,  
  0x00,  0x18,  20,  20,  0x1,  
  0x00,  0x18,  19,  19,  0x1,  
  0x00,  0x18,  18,  18,  0x1,  
  0x00,  0x18,  17,  17,  0x1,  
  0x00,  0x18,  16,  16,  0x1,  
  0x00,  0x18,  15,  15,  0x1,  
  0x00,  0x18,  14,  14,  0x1,  
  0x00,  0x18,  12,  12,  0x1,  
  0x00,  0x18,  11,  11,  0x1,  
  0x00,  0x18,  10,  10,  0x1,  
  0x00,  0x18,  9,  9,  0x1,  
  0x00,  0x18,  8,  8,  0x1,  
  0x00,  0x18,  7,  7,  0x1,  
  0x00,  0x18,  6,  6,  0x1,  
  0x00,  0x18,  5,  5,  0x1,  
  0x00,  0x18,  4,  4,  0x1,  
  0x00,  0x18,  3,  3,  0x1,  
  0x00,  0x18,  2,  2,  0x1,  
  0x00,  0x18,  1,  1,  0x1,  
  0x00,  0x18,  0,  0,  0x1,  
  0x00,  0x20,  26,  24,  0x2,  
  0x00,  0x20,  8,  0,  0x1,  
  0x00,  0x21,  31,  31,  0x1,  
  0x00,  0x21,  8,  8,  0x0,  
  0x00,  0x0C0,  11,  8,  0x4,  
  0x00,  0x0C0,  7,  4,  0x4,  
  0x00,  0x0C0,  3,  0,  0x4,  
  0x03,  0x3,  29,  24,  0x4,  
  0x03,  0x3,  21,  16,  0x4,  
  0x03,  0x3,  13,  8,  0x4,  
  0x03,  0x3,  5,  0,  0x4,  
  0x03,  0x4,  29,  24,  0x4,  
  0x03,  0x4,  21,  16,  0x4,  
  0x03,  0x4,  13,  8,  0x4,  
  0x03,  0x4,  5,  0,  0x4,  
  0x03,  0x5,  21,  16,  0x4,  
  0x03,  0x5,  13,  8,  0x4,  
  0x03,  0x5,  5,  0,  0x8,  
  0x03,  0x7,  31,  24,  0x20,  
  0x03,  0x7,  15,  8,  0x0A,  
  0x03,  0x7,  7,  0,  0x10,  
  0x03,  0x8,  23,  0,  0x0,  
  0x03,  0x9,  23,  0,  0x3FFFFC,  
  0x03,  0x0A,  9,  0,  0x080,  
  0x03,  0x0B,  29,  24,  0x1F,  
  0x03,  0x0B,  21,  16,  0x2F,  
  0x03,  0x0B,  13,  8,  0x2F,  
  0x03,  0x0B,  5,  0,  0x2F,  
  0x03,  0x0C,  29,  24,  0x2F,  
  0x03,  0x0C,  21,  16,  0x2F,  
  0x03,  0x0C,  13,  8,  0x2F,  
  0x03,  0x0C,  5,  0,  0x2B,  
  0x03,  0x0D,  21,  16,  0x2F,  
  0x03,  0x0D,  13,  8,  0x2F,  
  0x03,  0x0D,  5,  0,  0x2F,  
  0x03,  0x0F,  29,  28,  0x0,  
  0x03,  0x0F,  25,  24,  0x0,  
  0x03,  0x0F,  21,  20,  0x0,  
  0x03,  0x0F,  17,  16,  0x0,  
  0x03,  0x0F,  13,  12,  0x0,  
  0x03,  0x0F,  9,  8,  0x0,  
  0x03,  0x0F,  5,  4,  0x0,  
  0x03,  0x0F,  1,  0,  0x0,  
  0x03,  0x10,  9,  8,  0x0,  
  0x03,  0x10,  5,  4,  0x0,  
  0x03,  0x10,  1,  0,  0x0,  
  0x03,  0x11,  31,  22,  0x20,  
  0x03,  0x11,  18,  18,  0x1,  
  0x03,  0x11,  17,  12,  0x4,  
  0x03,  0x11,  11,  8,  0x8,  
  0x03,  0x12,  31,  30,  0x0,  
  0x03,  0x12,  29,  28,  0x0,  
  0x03,  0x12,  27,  26,  0x0,  
  0x03,  0x12,  25,  24,  0x0,  
  0x03,  0x12,  23,  22,  0x0,  
  0x03,  0x12,  21,  20,  0x0,  
  0x03,  0x12,  19,  18,  0x0,  
  0x03,  0x12,  17,  16,  0x1,  
  0x03,  0x12,  15,  14,  0x0,  
  0x03,  0x12,  13,  12,  0x0,  
  0x03,  0x12,  11,  10,  0x1,  
  0x03,  0x12,  9,  8,  0x1,  
  0x03,  0x12,  7,  6,  0x0,  
  0x03,  0x12,  5,  4,  0x0,  
  0x03,  0x12,  3,  2,  0x0,  
  0x03,  0x12,  1,  0,  0x0,  
  0x03,  0x14,  31,  31,  0x0,  
  0x03,  0x14,  30,  30,  0x0,  
  0x03,  0x14,  13,  8,  0x8,  
  0x03,  0x14,  5,  0,  0x10,  
  0x03,  0x16,  31,  31,  0x0,  
  0x03,  0x16,  13,  8,  0x3F,  
  0x03,  0x16,  5,  0,  0x8,  
  0x03,  0x18,  31,  24,  0x20,  
  0x03,  0x18,  23,  21,  0x6,  
  0x03,  0x18,  13,  7,  0x0,  
  0x03,  0x18,  6,  0,  0x20,  
  0x03,  0x3B,  23,  16,  0x4,  
  0x03,  0x3B,  9,  9,  0x0,  
  0x03,  0x3B,  7,  0,  0x0A,  
  0x03,  0x3C,  31,  16,  0x0FFFF,  
  0x03,  0x3C,  2,  2,  0x0,  
  0x03,  0x3C,  1,  1,  0x0,  
  0x03,  0x3D,  14,  14,  0x1,  
  0x03,  0x3D,  13,  13,  0x0,  
  0x03,  0x3D,  12,  12,  0x0,  
  0x03,  0x3D,  11,  11,  0x0,  
  0x03,  0x3D,  8,  8,  0x0,  
  0x03,  0x3D,  7,  7,  0x0,  
  0x03,  0x3D,  6,  6,  0x0,  
  0x03,  0x3D,  5,  5,  0x0,  
  0x03,  0x3D,  2,  2,  0x1,  
  0x03,  0x3D,  1,  1,  0x1,  
  0x03,  0x3D,  0,  0,  0x1,  
  0x03,  0x3E,  31,  16,  0x0,  
  0x03,  0x3E,  7,  0,  0x0,  
  0x03,  0x3F,  31,  24,  0x0FF,  
  0x03,  0x3F,  23,  16,  0x0FF,  
  0x03,  0x3F,  15,  8,  0x0FF,  
  0x03,  0x3F,  7,  0,  0x0FF,  
  
  0x02,  0x3,  20,  20,  0x1,  
  0x02,  0x3,  19,  19,  0x0,  
  0x02,  0x3,  18,  18,  0x0,  
  0x02,  0x3,  17,  17,  0x0,  
  0x02,  0x3,  16,  16,  0x1,  
  0x02,  0x3,  15,  15,  0x0,  
  
  0x02,  0x3,  10,  10,  0x1,  
  0x02,  0x3,  3,  3,  0x0,  
  0x02,  0x3,  2,  2,  0x0,  
  0x02,  0x4,  18,  18,  0x1,  
  0x02,  0x4,  4,  1,  0x8,  
  0x02,  0x4,  0,  0,  0x0,  
  0x02,  0x5,  27,  27,  0x1,  
  0x02,  0x5,  26,  26,  0x1,  
  0x02,  0x5,  25,  25,  0x1,  
  0x02,  0x5,  24,  24,  0x1,  
  0x02,  0x5,  23,  23,  0x1,  
  0x02,  0x5,  22,  22,  0x1,  
  0x02,  0x5,  21,  21,  0x1,  
  0x02,  0x5,  20,  20,  0x1,  
  0x02,  0x5,  19,  19,  0x1,  
  0x02,  0x5,  18,  18,  0x1,  
  0x02,  0x5,  17,  17,  0x1,  
  0x02,  0x5,  16,  16,  0x1,  
  0x02,  0x5,  15,  15,  0x1,  
  0x02,  0x5,  14,  14,  0x1,  
  0x02,  0x5,  13,  13,  0x1,  
  0x02,  0x5,  12,  12,  0x1,  
  0x02,  0x5,  11,  11,  0x1,  
  0x02,  0x5,  10,  10,  0x1,  
  0x02,  0x5,  9,  9,  0x1,  
  0x02,  0x5,  8,  8,  0x1,  
  0x02,  0x5,  7,  7,  0x1,  
  0x02,  0x5,  6,  6,  0x1,  
  0x02,  0x5,  5,  5,  0x1,  
  0x02,  0x5,  4,  4,  0x1,  
  0x02,  0x5,  3,  3,  0x1,  
  0x02,  0x5,  2,  2,  0x1,  
  0x02,  0x5,  1,  1,  0x1,  
  0x02,  0x5,  0,  0,  0x1,  
  0x58,  0x40,  4,  4,  0x0,  
  0x58,  0x40,  4,  4,  0x0,  
  0x58,  0x40,  4,  4,  0x0,  
  0x55,  0x54,  1,  0,  0x0,  
  0x55,  0x0FC,  17,  17,  0x0,  
  0x55,  0x0FC,  9,  9,  0x0,  
  0xA2,  0x0C000,  0,  0,  0x0,  
  0x47,  0x0C000,  0,  0,  0x0,  
  0x45,  0x0C000,  0,  0,  0x0,  
  0x46,  0x0C000,  0,  0,  0x0,  
  0x04,  0x0,  11,  11,  0x1,  
  0x04,  0x0,  10,  10,  0x1,  

  
  
  
  0x58,  0x1e0,    4,    4,    0x1,    
  0x58,  0x1e0,    0,    0,    0x0,    
  0x58,  0x1e0,    5,    5,    0x1,    
  0x58,  0x1e0,    3,    3,    0x1,    
  0x58,  0x1e0,    1,    1,    0x1,    
  0x58,  0x1e0,    2,    2,    0x1,    
  0xa9,  0x28,    31,    0,    0x0,    
  0xa9,  0x38,    31,    0,    0x0,    
  0xa9,  0x1c,    29,   28,    0x0,    
  0xa9,  0x1c,    25,   24,    0x0,    
  0xa9,  0x1c,     1,    0,    0x0,    
  0xa9,  0x54,    17,   16,    0x0,    
  0xa9,  0x54,    13,   12,    0x0,    
  0xa9,  0x54,    15,   14,    0x0,    
  0xa9,  0x54,    26,   24,    0x0,    
  0xa9,  0x24,    24,   20,    0x0,    
  0x59,  0x1e0,    4,    4,    0x1,    
  0x59,  0x1e0,    0,    0,    0x1,    
  0x59,  0x1e0,    5,    5,    0x1,    
  0x59,  0x1e0,    3,    3,    0x1,    
  0x59,  0x1e0,    1,    1,    0x1,    
  0x59,  0x1e0,    2,    2,    0x1,    
  0x5a,  0xd0,     8,    0,   0x3f,    
  0x5a,  0x40,    21,   19,    0x6,    
  0x5a,  0x40,    10,    8,    0x1,    
  0x5a,  0x40,    18,   18,    0x1,    
  0x5a,  0x50,     3,    3,    0x1,    
  0x5a,  0x50,     0,    0,    0x1,    
  0x5a,  0x50,     1,    1,    0x1,    
  0x5a,  0x50,     2,    2,    0x1,    
  0x5a,  0x50,     7,    5,    0x2,    
  0x5a,  0x50,    13,   13,    0x1,    
  0x5a,  0x50,     4,    4,    0x1,    
  0x5a,  0x50,    14,   14,    0x1,    
  0x5a,  0x50,    12,   12,    0x0,    
  0x5a,  0x50,    11,   10,    0x3,    
  0x48,  0x4900,  16,   16,    0x1,    
  0xa8,  0x4900,  16,   16,    0x1,    
  0xa0,  0x180,    1,    1,    0x1,    
  0xa0,  0x180,    4,    4,    0x1,    
  0xa0,  0x180,    0,    0,    0x1,    
  0xa0,  0x180,    3,    3,    0x1,    
  0xa0,  0x180,    5,    5,    0x1,    
  0xa0,  0x180,    2,    2,    0x1,    
  
  
  
  
  0x63,  0x600,   31,   15,    0x5,    
  0x63,  0x1e0,    4,    4,    0x1,    
  0x63,  0x1e0,    0,    0,    0x1,    
  0x63,  0x1e0,    5,    5,    0x1,    
  0x63,  0x1e0,    3,    3,    0x1,    
  0x63,  0x1e0,    1,    1,    0x1,    
  0x63,  0x1e0,    2,    2,    0x1,    
  0x44,  0x88,     7,    7,    0x0,    
  0x44,  0x88,     1,    1,    0x0,    
  0x44,  0x88,     2,    2,    0x0,    
  0x44,  0x88,     3,    3,    0x0,    
  0x44,  0x88,     4,    4,    0x0,    
  0x44,  0x88,     6,    6,    0x0,    
  0x44,  0x88,     5,    5,    0x0,    
  0x44,  0x88,     0,    0,    0x0,    
};



PNP_SETTING_EX g_PnpSettingExB0Stepping[] = {

  0x53,   0x0,   0x1,   0x1,   0x0,   0x0,   0x1C,   8,   8,   0x0,       
  0x53,   0x0,   0x1,   0x1,   0x0,   0x0,   0x8C,   9,   9,   0x0,       
  0x53,   0x0,   0x1,   0x1,   0x0,   0x0,   0x8C,   8,   8,   0x0,       
};

//
// Default set to A0 device table
//
PNP_SETTING *g_PnPValueForPwrPerf = g_PnPValueForPwrPerfA0Stepping;
UINT32       g_PnpSettingArraySize = 0;
UINT32       PnpExEnabled = 0;

VOID
PnpSettingEx (UINT32 PnpExEnabledFlag)
{
  volatile UINT32   Index;
  UINT8    Index1;
  UINT32   Value = 0;
  UINT32   Mask;
  PNP_SETTING_EX*  PnpSettingDataArray;
  UINT32  PnpSettingArraySize;
  UINT32  Result = 0;

  if (PnpExEnabledFlag == 0) {
    DEBUG ((EFI_D_ERROR, "No PnpDxe Power & Performance Ex table executed\n"));
    return;
  }
  DEBUG ((EFI_D_ERROR, "PnpDxe Power & Performance Ex table executed\n"));
  //
  // Power & Performance Ex
  //
  PnpSettingDataArray = g_PnpSettingExB0Stepping;
  PnpSettingArraySize = sizeof (g_PnpSettingExB0Stepping);
  DEBUG ((EFI_D_ERROR, "Pnp Table address 0x%x, count =%d\n",PnpSettingDataArray,PnpSettingArraySize/sizeof(PNP_SETTING_EX)  ));
  for (Index = 0; Index <  PnpSettingArraySize/sizeof(PNP_SETTING_EX); Index++) {
    if ((PnpSettingDataArray[Index].MsgPort ==0) && (PnpSettingDataArray[Index].MsgRegAddr == 0) &&(PnpSettingDataArray[Index].Value == 0) ) {

      continue;
    }

    Mask = 0;
    for (Index1 = PnpSettingDataArray[Index].LSB; Index1 <= PnpSettingDataArray[Index].MSB; Index1++ ) {
      Mask |=  (1 << Index1);
    }

    MsgBus32ReadEx( PnpSettingDataArray[Index].MsgReadOpcode,PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr, Value, PnpSettingDataArray[Index].BarIndex, PnpSettingDataArray[Index].Device, PnpSettingDataArray[Index].Function);

    Value &=  ~Mask;
    Value |=  (PnpSettingDataArray[Index].Value <<PnpSettingDataArray[Index].LSB);
    MsgBus32WriteEx(PnpSettingDataArray[Index].MsgWriteOpcode,PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr, Value, PnpSettingDataArray[Index].BarIndex, PnpSettingDataArray[Index].Device, PnpSettingDataArray[Index].Function);

    MsgBus32ReadEx( PnpSettingDataArray[Index].MsgReadOpcode,PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr, Result, PnpSettingDataArray[Index].BarIndex, PnpSettingDataArray[Index].Device, PnpSettingDataArray[Index].Function );

    Result = ((Result&Mask) >> PnpSettingDataArray[Index].LSB);
    


  }
  DEBUG ((EFI_D_ERROR, "PnpDxe Power & Performance Ex table Setting Completed\n"));
}

VOID
PnpSetting (VOID)
{
  volatile UINT32   Index;
  UINT8    Index1;
  UINT32   Value;
  UINT32   Mask;
  PNP_SETTING*  PnpSettingDataArray;
  UINT32  PnpSettingArraySize;
  UINT32  Result;

  DEBUG ((EFI_D_ERROR, "PnpDxe Power & Performance\n"));
  //
  // Power & Performance
  //
  PnpSettingDataArray = g_PnPValueForPwrPerf;
  PnpSettingArraySize = g_PnpSettingArraySize;

  for (Index = 0; Index <  PnpSettingArraySize/sizeof(PNP_SETTING); Index++) {
    if ((PnpSettingDataArray[Index].MsgPort ==0) && (PnpSettingDataArray[Index].MsgRegAddr == 0) &&(PnpSettingDataArray[Index].Value == 0) ) {
      continue;
    }

    Mask = 0;
    for (Index1 = PnpSettingDataArray[Index].LSB; Index1 <= PnpSettingDataArray[Index].MSB; Index1++ ) {
      Mask |=  (1 << Index1);
    }

    MsgBus32Read(PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr, Value);
    Value &=  ~Mask;
    Value |=  (PnpSettingDataArray[Index].Value <<PnpSettingDataArray[Index].LSB);
    MsgBus32Write(PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr,Value);

    MsgBus32Read(PnpSettingDataArray[Index].MsgPort, PnpSettingDataArray[Index].MsgRegAddr, Result);
    Result = ((Result&Mask) >> PnpSettingDataArray[Index].LSB);
  }

  //PnpSettingEx(PnpExEnabled);

}

//#if defined (BYTI_PF_ENABLE) && (BYTI_PF_ENABLE == 1) 
VOID
Disable_MasterClkGateEn (VOID)
{
  UINT32   Value;
  MsgBus32Read(0x03, 0x3D, Value);  //register BCTRL 
  Value &=  0xFFFFFFFD;  //clear MASTERCLK_GATE_EN
  MsgBus32Write(0x03, 0x3D, Value);
  MsgBus32Read(0x03, 0x3D, Value);  //register BCTRL 
  DEBUG ((EFI_D_ERROR, "BCTRL after disable MASTERCLK_GATE_EN: 0x%x\n", Value));
}
//#endif

EFI_STATUS
EFIAPI
InitializePnpSetting (
  IN EFI_HANDLE        ImageHandle,
  IN EFI_SYSTEM_TABLE  *SystemTable
  )
/*++

Routine Description:

  Initialize the power and performance Setting.

Arguments:

  ImageHandle   - Pointer to the loaded image protocol for this driver
  SystemTable   - Pointer to the EFI System Table

Returns:

  EFI_SUCCESS   The driver installed/initialized correctly.

--*/
{
  EFI_STATUS  Status = EFI_SUCCESS;
  SETUP_DATA          SystemConfiguration;    // AMI_OVERRIDE
  UINTN       VarSize;
//#if defined (BYTI_PF_ENABLE) && (BYTI_PF_ENABLE == 1) 
  EFI_PLATFORM_INFO_HOB       *PlatformInfo;
  EFI_PEI_HOB_POINTERS        Hob;
//#endif
  DEBUG ((EFI_D_ERROR, "Config PnpSetting Start !!!\n"));
  VarSize = sizeof(SETUP_DATA);    // AMI_OVERRIDE
  Status = gRT->GetVariable(L"Setup",
                            &gEfiNormalSetupGuid,
                            NULL,
                            &VarSize,
                            &SystemConfiguration);
  ASSERT_EFI_ERROR(Status);


  if (SystemConfiguration.PnpSettings == POWER_PERFORMANCE_SETTING_ENABLED_AUTO_DETECT) {

    // Silicon Stepping
    switch (PchStepping()) {
      case PchA0: // A0 and A1
      case PchA1:
        DEBUG ((EFI_D_ERROR, "A0/A1 PNP Power & Performance table\n"));
        g_PnPValueForPwrPerf = g_PnPValueForPwrPerfA0Stepping;
        g_PnpSettingArraySize =  sizeof (g_PnPValueForPwrPerfA0Stepping);
        PnpExEnabled = 0;
        break;
      case PchB0: // B0 and later
      default:
        DEBUG ((EFI_D_ERROR, "Bx PNP Power & Performance table\n"));
        g_PnPValueForPwrPerf = g_PnPValueForPwrPerfB0Stepping;
        g_PnpSettingArraySize =  sizeof (g_PnPValueForPwrPerfB0Stepping);
        PnpExEnabled = 1;
        break;
    }
  } else if (SystemConfiguration.PnpSettings == POWER_PERFORMANCE_SETTING_ENABLED_AX_STEPPING) {
    DEBUG ((EFI_D_ERROR, "A0/A1 PNP Power & Performance table\n"));
    g_PnPValueForPwrPerf = g_PnPValueForPwrPerfA0Stepping;
    g_PnpSettingArraySize =  sizeof (g_PnPValueForPwrPerfA0Stepping);
    PnpExEnabled = 0;
  } else if (SystemConfiguration.PnpSettings == POWER_PERFORMANCE_SETTING_ENABLED_BX_STEPPING) {
    DEBUG ((EFI_D_ERROR, "Bx PNP Power & Performance table\n"));
    g_PnPValueForPwrPerf = g_PnPValueForPwrPerfB0Stepping;
    g_PnpSettingArraySize =  sizeof (g_PnPValueForPwrPerfB0Stepping);
    PnpExEnabled = 1;
  } else {
    DEBUG ((EFI_D_ERROR, "Pnp setting is disabled. SkipConfi\nPnpSetting End !!!\n"));
    return EFI_SUCCESS;
  }

  PnpSetting();

//#if defined (BYTI_PF_ENABLE) && (BYTI_PF_ENABLE == 1) 
  Hob.Raw = GetFirstGuidHob (&gEfiPlatformInfoGuid);
  ASSERT (Hob.Raw != NULL);
  PlatformInfo = GET_GUID_HOB_DATA(Hob.Raw);
  if (PlatformInfo->BoardId == BOARD_ID_BS_RVP) {  
    Disable_MasterClkGateEn();  //Workaround for HSD#4634546 - disable Bunit masterclk_gate_en 
  }
//#endif
  DEBUG ((EFI_D_ERROR, "Config PnpSetting End !!!\n"));
  return EFI_SUCCESS;
}


